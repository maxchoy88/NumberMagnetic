<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°ç£ç©ºé—´ | å…«æ˜Ÿçµæ•°åœ¨çº¿åˆ†æ</title>
    <meta name="description" content="ä¸“ä¸šå…«æ˜Ÿçµæ•°åˆ†æå·¥å…·ï¼Œç”± Castor å¼€å‘">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --accent: #f59e0b;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --ji-color: #10b981;
            --xiong-color: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .brand {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--primary);
            letter-spacing: -0.5px;
        }
        .brand span { color: var(--text-main); }

        /* ä¸»å®¹å™¨ */
        .main-container {
            flex: 1;
            max-width: 800px;
            width: 95%;
            margin: 2rem auto;
            display: grid;
            gap: 1.5rem;
        }

        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* å¤´éƒ¨æ¬¢è¿åŒº */
        .header-section {
            text-align: center;
            padding: 2rem 1rem;
            background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%);
            color: white;
            border-radius: 1rem;
            margin-bottom: 1rem;
        }
        .header-section h1 { margin: 0; font-size: 1.8rem; }
        .header-section p { opacity: 0.9; margin-top: 0.5rem; font-size: 0.95rem; }

        /* è¾“å…¥åŒº */
        .input-wrapper {
            display: flex;
            gap: 10px;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { border-color: var(--primary); }
        .btn-analyze {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0 24px;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-analyze:hover { background-color: #4338ca; }

        /* ç»“æœåŒºåŸŸå¸ƒå±€ (Desktop: å·¦å³å¸ƒå±€, Mobile: ä¸Šä¸‹å¸ƒå±€) */
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
            display: none; /* é»˜è®¤éšè— */
        }
        @media (max-width: 768px) {
            .result-grid { grid-template-columns: 1fr; }
        }

        /* åˆ—è¡¨é¡¹æ ·å¼ */
        .star-list { display: flex; flex-direction: column; gap: 10px; }
        .star-row {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            background: #f9fafb;
            border-left: 4px solid transparent;
        }
        .star-row.ji { border-left-color: var(--ji-color); background: #ecfdf5; }
        .star-row.xiong { border-left-color: var(--xiong-color); background: #fef2f2; }
        
        .num-badge {
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: bold;
            margin-right: 12px;
            color: var(--text-main);
        }
        .star-name {
            font-size: 0.9rem;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            color: white;
            margin-right: auto;
        }
        .bg-ji { background-color: var(--ji-color); }
        .bg-xiong { background-color: var(--xiong-color); }
        .star-desc { font-size: 0.8rem; color: var(--text-sub); }

        /* å¤åˆ¶æŒ‰é’® */
        .copy-btn {
            width: 100%;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .copy-btn:hover { background: #eef2ff; }

        /* é¡µè„š */
        footer {
            text-align: center;
            padding: 2rem;
            font-size: 0.85rem;
            color: var(--text-sub);
            margin-top: auto;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand">Num<span>Magnet</span></div>
        <div style="font-size: 0.9rem; color: #6b7280;">Castor's Tool</div>
    </nav>

    <div class="main-container">
        
        <div class="header-section">
            <h1>æ•°ç£ç©ºé—´</h1>
            <p>è¾“å…¥æ‰‹æœºå· / è½¦ç‰Œ / çƒå‘˜å·ç ï¼Œè§£æèƒŒåçš„èƒ½é‡ç£åœº</p>
        </div>

        <div class="card">
            <div class="input-wrapper">
                <input type="text" id="phoneInput" placeholder="è¯·è¾“å…¥å·ç  (å¦‚: 0123456789)" onkeypress="if(event.keyCode==13) analyze()">
                <button class="btn-analyze" onclick="analyze()">ç«‹å³åˆ†æ</button>
            </div>
            <div id="history-tags" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
                </div>
        </div>

        <div id="resultArea" class="result-grid">
            
            <div class="card">
                <h3 style="margin-top:0;">èƒ½é‡åˆ†å¸ƒ</h3>
                <canvas id="energyChart" width="100%" height="60"></canvas>
                <div id="summaryText" style="margin-top: 15px; line-height: 1.6; font-size: 0.95rem; color: var(--text-sub);"></div>
                <button class="copy-btn" onclick="copyReport()">ğŸ“‹ å¤åˆ¶åˆ†ææŠ¥å‘Šç»™å®¢æˆ·</button>
            </div>

            <div class="card">
                <h3 style="margin-top:0;">ç£åœºè¯¦è§£</h3>
                <div id="detailList" class="star-list"></div>
            </div>
        </div>

    </div>

    <footer>
        &copy; 2026 CFC Youth Academy & Castor Tech Lab.<br>
        Powered by NumMagnet Algorithm V4.0
    </footer>

    <script>
        // æ ¸å¿ƒæ•°æ®
        const starMap = {
            "å¤©åŒ»": { p: ["13","31","68","86","49","94","27","72"], t: "ji", d: "æ­£è´¢ / æ­£ç¼˜ / èªæ˜" },
            "å»¶å¹´": { p: ["19","91","78","87","34","43","26","62"], t: "ji", d: "äº‹ä¸š / é¢†å¯¼ / è´£ä»»" },
            "ç”Ÿæ°”": { p: ["14","41","67","76","39","93","28","82"], t: "ji", d: "è´µäºº / ä¹å¤© / åæ°”" },
            "ä¼ä½": { p: ["11","22","88","99","66","77","33","44"], t: "ji", d: "è“„åŠ¿ / æ€è€ƒ / å¹³ç¨³" },
            "ç»å‘½": { p: ["12","21","69","96","48","84","37","73"], t: "xiong", d: "å†²åŠ¨ / æŠ•èµ„ / ç ´è´¢" },
            "äº”é¬¼": { p: ["18","81","79","97","36","63","24","42"], t: "xiong", d: "å˜åŠ¨ / æ‰å / å¼‚åœ°" },
            "å…­ç…": { p: ["16","61","47","74","38","83","29","92"], t: "xiong", d: "æ¡ƒèŠ± / å¿§éƒ / äººé™…" },
            "ç¥¸å®³": { p: ["17","71","89","98","46","64","23","32"], t: "xiong", d: "å£èˆŒ / ç–¾ç—… / å°äºº" }
        };

        let chartInstance = null;
        let lastReportText = "";

        // åˆ†æä¸»å‡½æ•°
        function analyze() {
            const raw = document.getElementById('phoneInput').value.replace(/[^\d]/g,'');
            if (raw.length < 2) { alert("è¯·è¾“å…¥è‡³å°‘2ä½æ•°å­—"); return; }
            
            document.getElementById('resultArea').style.display = 'grid';
            saveHistory(raw);

            // ç®—æ³•æ ¸å¿ƒ
            let pairs = [];
            let stats = { ji: 0, xiong: 0 };
            
            for (let i = 0; i < raw.length - 1; i++) {
                if (raw[i] === '0' || raw[i] === '5') continue;
                
                let nextIdx = i + 1;
                let note = "";
                while(nextIdx < raw.length) {
                    if(raw[nextIdx] === '0') note += " [éš]";
                    else if(raw[nextIdx] === '5') note += " [å¼º]";
                    else break;
                    nextIdx++;
                }

                if (nextIdx < raw.length) {
                    let p = raw[i] + raw[nextIdx];
                    let star = "æœªçŸ¥", info = {t:'none', d:''};
                    
                    for(let k in starMap) {
                        if(starMap[k].p.includes(p)) {
                            star = k;
                            info = starMap[k];
                            info.t === 'ji' ? stats.ji++ : stats.xiong++;
                            break;
                        }
                    }
                    pairs.push({ num: raw.substring(i, nextIdx+1), star, info, note });
                }
            }

            renderUI(pairs, stats, raw);
        }

        // æ¸²æŸ“ç•Œé¢
        function renderUI(pairs, stats, rawNum) {
            // 1. åˆ—è¡¨
            const listDiv = document.getElementById('detailList');
            listDiv.innerHTML = pairs.map(item => `
                <div class="star-row ${item.info.t}">
                    <span class="num-badge">${item.num}</span>
                    <span class="star-name ${item.info.t === 'ji' ? 'bg-ji' : 'bg-xiong'}">${item.star}</span>
                    <span class="star-desc">${item.info.d} ${item.note}</span>
                </div>
            `).join('');

            // 2. å›¾è¡¨
            const ctx = document.getElementById('energyChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['å‰æ˜Ÿ (è´¢è¿/äº‹ä¸š/è´µäºº)', 'å‡¶æ˜Ÿ (å˜åŠ¨/å£èˆŒ/å‹åŠ›)'],
                    datasets: [{
                        data: [stats.ji, stats.xiong],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '75%', plugins: { legend: { position: 'bottom' } } }
            });

            // 3. æ€»ç»“æ–‡æ¡ˆ
            const summary = `<strong>å·ç åˆ†æ (${rawNum})ï¼š</strong><br>
            æ­¤å·ç åŒ…å« ${pairs.length} ç»„æ ¸å¿ƒç£åœºã€‚<br>
            å‰æ˜Ÿå æ¯” ${Math.round((stats.ji / (stats.ji+stats.xiong))*100)}%ï¼Œ
            å‡¶æ˜Ÿå æ¯” ${Math.round((stats.xiong / (stats.ji+stats.xiong))*100)}%ã€‚<br>
            ${stats.ji > stats.xiong ? 'æ•´ä½“èƒ½é‡åæ­£å‘ï¼Œåˆ©äºç¨³æ­¥å‘å±•ã€‚' : 'æ•´ä½“èƒ½é‡æ³¢åŠ¨è¾ƒå¤§ï¼Œéœ€æ³¨æ„å¤§èµ·å¤§è½ã€‚'}`;
            
            document.getElementById('summaryText').innerHTML = summary;
            
            // å‡†å¤‡çº¯æ–‡æœ¬æŠ¥å‘Šä¾›å¤åˆ¶
            lastReportText = `ã€æ•°ç£ç©ºé—´åˆ†ææŠ¥å‘Šã€‘\nå·ç ï¼š${rawNum}\n------------------\n${pairs.map(p => `${p.num} â†’ ${p.star} (${p.info.d})`).join('\n')}\n------------------\næ€»è¯„ï¼š${stats.ji > stats.xiong ? 'å‰æ˜Ÿä¸»å¯¼ï¼Œè¿åŠ¿å¹³ç¨³' : 'å‡¶æ˜Ÿä¸»å¯¼ï¼Œæ³¨æ„é£é™©'}\n(æ¥è‡ª Castor çš„ä¸“ä¸šåˆ†æ)`;
        }

        // å¤åˆ¶åŠŸèƒ½
        function copyReport() {
            navigator.clipboard.writeText(lastReportText).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.innerHTML = "âœ… å·²å¤åˆ¶ï¼å¯å»ç²˜è´´";
                setTimeout(() => btn.innerHTML = "ğŸ“‹ å¤åˆ¶åˆ†ææŠ¥å‘Šç»™å®¢æˆ·", 2000);
            });
        }

        // å†å²è®°å½•
        function saveHistory(num) {
            let h = JSON.parse(localStorage.getItem('web_hist') || '[]');
            if(!h.includes(num)) {
                h.unshift(num);
                if(h.length > 5) h.pop();
                localStorage.setItem('web_hist', JSON.stringify(h));
            }
            renderHistory();
        }

        function renderHistory() {
            const h = JSON.parse(localStorage.getItem('web_hist') || '[]');
            const container = document.getElementById('history-tags');
            container.innerHTML = h.map(n => `
                <span onclick="document.getElementById('phoneInput').value='${n}';analyze()" 
                      style="font-size:12px; padding:4px 10px; background:#e5e7eb; border-radius:15px; cursor:pointer;">
                      ${n}
                </span>
            `).join('');
        }
        
        // åˆå§‹åŠ è½½å†å²
        renderHistory();
    </script>
</body>
</html>
